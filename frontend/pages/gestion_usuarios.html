<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Inicio | Ministerio de Educación Pública</title>
    <link rel="stylesheet" href="../css/index.css">
    <link rel="stylesheet" href="../css/header.css">
    <link rel="stylesheet" href="../css/footer.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
</head>

<body>
    <div id="header"></div>
        <main class="container my-5">
            <h2>Gestión de Usuarios</h2>
            <section class="user-list">
                <h3>Lista de Usuarios</h3>
                <table id="usersTable" class="table table-bordered table-striped table-hover table-sm">
                    <thead class="table-light">
                        <tr>
                            <th>Nombre</th>
                            <th>Email</th>
                            <th>Rol</th>
                            <th>Activo</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Usuarios serán incluidos con JS -->
                    </tbody>
                </table>
            </section>
            <section class="user-actions">
                <h3>Acciones</h3>
                <button onclick="mostrarFormularioRegistro()" class="btn-mep">Registrar Nuevo Usuario</button>
                <!-- Formulario de registro puede mostrarse en un modal o sección separada -->
                <div id="registrationSection" style="display: none;">
                    <!-- Incluir el body del formulario de registro aquí si es necesario, o enlazar a la página de registro -->
                    <h2>Registro de Usuarios</h2>
                    <form id="registrationForm" action="/register" method="POST">
                        <label for="nombre">Nombre:</label>
                        <input type="text" id="nombre" name="nombre" required>
                        
                        <label for="email">Correo Electrónico:</label>
                        <input type="email" id="email" name="email" required>
                        
                        <label for="password">Contraseña:</label>
                        <input type="password" id="password" name="password" required>
                        
                        <label for="rol">Rol:</label>
                        <select id="rol" name="rol" style="margin-top: 0.5rem;" required>
                            <option value="docente">Docente</option>
                            <option value="padre">Padre de Familia</option>
                        </select>
                        
                        <button type="submit" class="btn-mep">Registrar Usuario</button>
                    </form>
                </div>
            </section>
        </main>
        <script>
            // JavaScript para cargar y mostrar usuarios
            async function cargarUsuarios() {
                const respuesta = await fetch('/users');
                const usuarios = await respuesta.json();
                const cuerpoTabla = document.querySelector('#usersTable tbody');
                cuerpoTabla.innerHTML = '';
                usuarios.forEach(usuario => {
                    const fila = document.createElement('tr');
                    fila.innerHTML = `
                        <td>${usuario.nombre}</td>
                        <td>${usuario.email}</td>
                        <td>${usuario.rol}</td>
                        <td>${usuario.activo ? 'Sí' : 'No'}</td>
                        <td>
                            <button onclick="editarUsuario('${usuario._id}')">Editar</button>
                            <button onclick="desactivarUsuario('${usuario._id}')">Desactivar</button>
                        </td>
                    `;
                    cuerpoTabla.appendChild(fila);
                });
            }

            function mostrarFormularioRegistro() {
                // Redirigir a la página de registro o mostrar formulario
                window.location.href = '/frontend/pages/registro.html';
            }

            async function editarUsuario(id) {
                // Obtener datos del usuario y mostrar formulario de edición (implementar según sea necesario)
                alert('Editar usuario ' + id);
            }

            async function desactivarUsuario(id) {
                await fetch(`/users/${id}/deactivate`, { method: 'PUT' });
                cargarUsuarios();
            }

            window.onload = cargarUsuarios;
        </script>

    <div id="footer"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
    <script src="../js/index.js"></script>

</body>

</html>